library(rstan)
sm3 <- stan_model(file="dbeta_rando.stan", model_name='p2mod',verbose=FALSE)
sm3 <- stan_model(file="dbeta_rando.stan", model_name='p2mod',verbose=FALSE)
source("dpqr_betadiscr.R")
source("discrete_beta_R.R")
y = c(4,5,6,7,5,6,7,4,3,4,5,6,,5,9,4,8,3,7,6,9,3,6,2,6)
y = c(4,5,6,7,5,6,7,4,3,4,5,6,5,9,4,8,3,7,6,9,3,6,2,6)
length(y)
data_ex = data.frame(
y = c(4,5,6,7,5,6,7,4,3,4,5,6,5,9,4,8,3,7,6,9,3,6,2,6),
time = rep(1:2, 12),
)
data_ex = data.frame(
y = c(4,5,6,7,5,6,7,4,3,4,5,6,5,9,4,8,3,7,6,9,3,6,2,6),
time = rep(1:2, 12)
)
data_ex
data_ex = data.frame(
y = c(4,5,6,7,5,6,7,4,3,4,5,6,5,9,4,8,3,7,6,9,3,6,2,6),
time = factor(rep(1:2, 12)),
group = factor(rep(1:2, each=12))
)
data_ex
data_ex = data.frame(
y = c(4,5,6,7,5,6,7,4,3,4,5,6,5,9,4,8,3,7,6,9,3,6,2,6),
time = factor(rep(1:2, 12)),
group = factor(rep(1:2, each=12)),
id = factor(rep(1:12, each=2))
)
data_ex
data_ex = data.frame(
y = c(4,5,6,7,5,6,7,4,3,4,5,6,5,9,4,8,3,7,6,9,3,6,2,6),
time = factor(rep(1:2, 12)),
group = factor(rep(1:2, each=12)),
id = rep(1:12, each=2)
)
y = cbind(data_ex$y,10-data_ex$y)  # assuming 10 as maximum value for y
formulamu = ~  group + time
formulaphi = ~ time
id = as.integer(data_ex$id)
size <- sum(y[1,]) # size of the betabinomial
#model matrices
mat_mutot <- model.matrix(formulamu, data)
#model matrices
mat_mutot <- model.matrix(formulamu, data_ex)
mat_phitot <- model.matrix(formulaphi, data_ex)
mat_mutot
K1=dim(mat_mutot)[2]
K2=dim(mat_phitot)[2]       # n parametri beta
n = length(unique(data_ex$id))
n
starting <- bdmod(y,formulamu,formulaphi,data)
starting <- bdmod(y,formulamu,formulaphi,data_ex)
starting
source("discrete_beta_R.R")
starting <- bdmod(y,formulamu,formulaphi,data_ex)
starting
data_s <- list(N=n,K1=K1, K2=K2, t=2, Size=size, matmu=mat_mutot, matphi=mat_phitot,
patient=paziente, y=y[,1], smu=starting$MU[,1], sphi=starting$PHI[,1] )
data_s <- list(N=n,K1=K1, K2=K2, t=2, Size=size, matmu=mat_mutot, matphi=mat_phitot,
patient=id, y=y[,1], smu=starting$MU[,1], sphi=starting$PHI[,1] )
reg <- sampling(sm3, data=data_s,iter=4000, chains=4)
reg
reg <- sampling(sm3, data=data_s,iter=2000, chains=2)
reg
